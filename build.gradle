buildscript {
    repositories {
        mavenCentral()
        maven {
            url "https://dl.bintray.com/jetbrains/kotlin-native-dependencies"
        }
    }

    dependencies {
        classpath "org.jetbrains.kotlin:kotlin-gradle-plugin:1.2.41"
        classpath files("/Users/orangy/Projects/kotlin-native/tools/kotlin-native-gradle-plugin/build/libs/kotlin-native-gradle-plugin-0.8-dev.jar")
    }
}

apply plugin: 'konan'

konan.targets = ['macos']

def konanUserDir = System.getenv("KONAN_DATA_DIR") ?: "${System.getProperty("user.home")}/.konan"

konanArtifacts {
    interop('sdl2') {
        packageName 'sdl2'

        target 'macos', {
            includeDirs '/usr/local/opt/sdl2/include/SDL2'
            includeDirs '/usr/local/opt/sdl2_image/include/SDL2'
            includeDirs '/usr/local/opt/sdl2_mixer/include/SDL2'
        }
    }

    library('ksdl') {
        libraries {
            artifact 'sdl2'
        }
        // srcFiles fileTree('framework/src')
        // testFiles fileTree('framework/test')
    }

    program('playground') {
        baseDir 'bin'

        libraries {
            artifact 'ksdl'
        }

        target 'macos', {
            linkerOpts "-L/usr/local/opt/sdl2/lib -L/usr/local/opt/sdl2_image/lib -L/usr/local/opt/sdl2_mixer/lib -lsdl2 -lsdl2_image -lsdl2_mixer"
        }
    }
}

compileKonan {
    doLast {
        konanArtifacts.playground.forEach() { task ->
            copy {
                from 'sample/resources'
                into task.artifact.parentFile
            }
        }
    }
}