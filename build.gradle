plugins {
    id 'org.jetbrains.kotlin.konan' version '0.8.2'
}

konan.targets = ['macos']

def konanUserDir = System.getenv("KONAN_DATA_DIR") ?: "${System.getProperty("user.home")}/.konan"

konanArtifacts {
    interop('sdl2') {
        packageName 'sdl2'

        target 'macos', {
            defFile = new File("sdl2/sdl2.def")
            includeDirs '/usr/local/opt/sdl2/include/SDL2'
            includeDirs '/usr/local/opt/sdl2_image/include/SDL2'
            includeDirs '/usr/local/opt/sdl2_mixer/include/SDL2'
        }
    }

    library('ksdl') {
        libraries {
            artifact 'sdl2'
        }
        srcDir 'ksdl/src'
        //testFiles fileTree('framework/test')
    }

    program('playground') {
        baseDir 'bin'
        srcDir 'playground/src'

        libraries {
            artifact 'ksdl'
        }

        target 'macos', {
            linkerOpts "-L/usr/local/opt/sdl2/lib -L/usr/local/opt/sdl2_image/lib -L/usr/local/opt/sdl2_mixer/lib -lsdl2 -lsdl2_image -lsdl2_mixer"
        }
    }
}

compileKonan {
    doLast {
        konanArtifacts.playground.forEach() { task ->
            copy {
                from 'playground/resources'
                into task.artifact.parentFile
            }
        }
    }
}